<div class="container whole-screen flex-grow-1"
data-controller="chatroom-subscription"
data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>"
data-chatroom-subscription-current-user-id-value="<%= current_user.id %>">

<!-- one row, two columns -->
<div class="row">
<!-- Left column -->
<div class="col-md-3 mt-4">
  <div class="conversations-sidebar">
    <div class="welcome-message">Chat with other players!</div>
      <div class="person">
        <span><i class="fa-regular fa-user me-2"></i><%= @user.first_name %> is currently online.</span>
      </div>

      <div class="chat-section">
        <div class="chat-section-header">
          <h3>Chatrooms</h3>
        </div>

        <% @chatrooms.each_with_index do |chatroom, index| %>
          <div class="channel d-flex">
            <span class="chat-icon"><i class="fa-regular fa-comments"></i></span>
              <%= link_to chatroom.name, chatroom_path(chatroom), class: "channel-link color-#{index + 1}" %>

          <!-- Kebab Menu -->
          <div class="dropdown ms-auto">
            <a href="#" class="no-underline" data-bs-toggle="modal" data-bs-target="#renameChatroomModal" data-bs-chatroom-id="<%= chatroom.id %>" data-bs-chatroom-name="<%= chatroom.name %>">
              <i class="fa-solid fa-ellipsis"></i>
            </a>
          </div>
        </div>
        <% end %>
      </div>


      <div data-controller="add-chatroom">
        <button id="chat-name" data-action="click->add-chatroom#fire" class="mb-3"><i class="fa-solid fa-plus"></i> Add a new chatroom</button>
          <div class="d-none" data-add-chatroom-target="toggleableElement">
            <%= render "chat_form", chatroom: @new_chatroom %>
          </div>
        </div>
      </div>
    </div>


<!-- Right column -->
<div class="col-md-9">
  <div class="chatroom-container">
    <div class="chat-header">
      <h1>#<%= @chatroom.name %></h1>
      <%= button_to "Continue playing", play_path, method: :get, class: "chatroom-btn" %>
    </div>

    <div class="messages" data-chatroom-subscription-target="messages">
      <% @chatroom.messages.each do |message| %>
        <div class="message-row d-flex <%= message.sender?(current_user) ? 'justify-content-end' : 'justify-content-start' %>">
          <div class="<%= message.sender?(current_user) ? 'sender-style' : 'receiver-style' %>">
          <%= render "messages/message", message: message %>
        </div>
      </div>
    <% end %>
  </div>


        <!-- when form is submitted it triggers the resetForm function -->
    <%= simple_form_for [@chatroom, @message], html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f|
    %>
        <%= f.input :content,
          label: false,
          placeholder: "Message ##{@chatroom.name}",
          wrapper_html: {class: "form-control flex-grow-1"}
        %>
        <%= f.submit "Send", class: "btn btn-chat mb-3" %>
        <% end %>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="renameChatroomModal" tabindex="-1" aria-labelledby="renameChatroomModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="renameChatroomModalLabel">Rename Chatroom</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= form_with model: @chatroom, url: chatroom_path(@chatroom), method: :patch, local: true, id: 'renameChatroomForm' do |f| %>
          <div class="mb-3">
            <%= f.label :name, "New Chatroom Name" %>
            <%= f.text_field :name, class: 'form-control', placeholder: 'Enter new chatroom name' %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <%= f.submit 'Rename', class: 'btn btn-primary' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
